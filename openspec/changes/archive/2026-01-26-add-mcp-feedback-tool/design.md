## Context

基於 `old/` 目錄中的舊版 MCP 反饋收集工具，開發全新版本。需要保持 MCP 協議相容性，同時提升 UI/UX 體驗、強化圖片處理功能、並建立完善的文件體系。

### 現有約束
- 必須保持 MCP API 介面向後相容
- 使用 Node.js 18.0.0+ 作為運行環境
- 支援 Windows、macOS、Linux 跨平台運行
- 維持模組化架構便於維護

### 利害關係人
- AI 助手（調用 MCP 工具）
- 終端用戶（提供反饋）
- 開發者（維護與擴展）

## Goals / Non-Goals

### Goals
- 提供穩定的 MCP 反饋收集核心機制
- 實現直觀的左右分割版面 UI
- 支援圖片拖放上傳、排序、彈窗檢視
- 建立可自定義的罐頭語快速回覆系統
- 提供完整的技術文件與 API 說明
- 確保跨平台相容性

### Non-Goals
- 不重新設計 MCP 協議本身
- 不引入複雜的前端框架（保持輕量）
- 不支援多語言國際化（首版）
- 不實作用戶認證機制

## Decisions

### 技術選擇
| 層面 | 決策 | 理由 |
|-----|------|-----|
| 語言 | TypeScript | 類型安全、維護性佳 |
| 運行環境 | Node.js 18+ | 現代 API 支援、LTS 版本 |
| 前端 | 原生 HTML/CSS/JS | 輕量、無依賴、快速載入 |
| CSS 佈局 | CSS Grid/Flexbox | 原生支援、無需框架 |
| 圖片處理 | Jimp | 服務端圖片壓縮，已有使用經驗 |
| 拖放功能 | HTML5 Drag and Drop API | 原生支援、跨瀏覽器相容 |
| 本地儲存 | localStorage | 罐頭語設定持久化 |

### 架構設計
```
src/
├── cli.ts              # CLI 入口
├── index.ts            # 模組導出
├── config/             # 配置管理
├── server/
│   ├── mcp-server.ts   # MCP 服務器核心
│   └── web-server.ts   # Web 介面服務
├── static/             # 前端資源
│   ├── index.html      # 主頁面
│   ├── styles.css      # 樣式
│   └── app.js          # 前端邏輯
├── types/              # TypeScript 類型定義
└── utils/              # 工具函數
```

### UI 設計決策
- **版面比例**: 60/40 左右分割（AI 報告:用戶回饋）
- **色彩主題**: 深色主題（配合 IDE 風格）
- **圖片區域**: 回饋區上方，網格顯示，支援拖動排序
- **罐頭語**: 固定底部，橫向按鈕排列

### 互動設計
- **拖放上傳**: 全頁面拖放區域，視覺化提示
- **圖片排序**: 拖動手柄調整順序，即時預覽
- **彈窗檢視**: 點擊圖片開啟模態框，支援縮放
- **罐頭語編輯**: 雙擊進入編輯模式

## Risks / Trade-offs

### 風險
| 風險 | 影響 | 緩解措施 |
|-----|------|---------|
| HTML5 拖放 API 舊瀏覽器支援有限 | 功能降級 | 提供 fallback 上傳按鈕 |
| 大圖片影響載入速度 | 用戶體驗下降 | 服務端壓縮、分塊上傳 |
| 跨平台路徑差異 | 檔案處理異常 | 使用 path 模組統一處理 |

### 權衡
- **輕量 vs 功能豐富**: 選擇原生技術保持輕量，犧牲部分高級 UI 效果
- **單檔架構 vs 模組化**: 採用模組化提升可維護性，但增加複雜度
- **向後相容 vs 新特性**: 優先保持 API 相容，新功能作為可選擴展

## Migration Plan

### 階段一：核心機制開發
1. 設置專案結構與 TypeScript 配置
2. 實作 MCP 服務器核心
3. 建立 Web 服務器基礎框架
4. 單元測試覆蓋

### 階段二：UI 開發
1. 實作左右分割版面
2. 開發圖片處理功能（拖放、排序、檢視）
3. 建立罐頭語系統
4. UI 測試驗證

### 階段三：文件與測試
1. 撰寫 README.md
2. 編寫 API 文件
3. 建立開發指南
4. 整合測試與效能優化

### 階段四：發布準備
1. 跨平台驗證
2. Docker 配置（可選）
3. 版本發布

### 回滾計畫
- 保留 `old/` 目錄作為備份
- 使用 git 分支管理開發版本
- 功能開關控制新特性啟用

## Open Questions

- 是否需要支援觸控裝置的手勢操作？
- 圖片上傳是否需要設定檔案大小上限？
- 是否需要新增鍵盤快捷鍵支援？
- 罐頭語最大數量是否需要限制？
